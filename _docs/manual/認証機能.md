# 認証機能

## 概要
認証機能は、システムへのアクセス制御とユーザー識別を行うための機能です。本システムではJWTベースの認証を実装し、ユーザーごとに適切な権限管理を行っています。また、セッション管理によりユーザーの状態を維持します。

**URL**: http://localhost:3000/login

## 主要機能

### ログイン認証
- メールアドレスとパスワードによるログイン
- ログイン状態の保持（セッション管理）
- アクセストークンの発行と検証
- 権限に基づくページアクセス制御

### ユーザー権限管理
- 複数の権限レベル（USER、ADMIN）
- 役割に基づいた機能へのアクセス制御
- ユーザーごとの表示内容の制御

### セキュリティ対策
- パスワードの安全な保存（ハッシュ化）
- JWTによる安全なトークン管理
- セッションタイムアウトの実装
- CSRFトークンによる保護

## データモデル

### ユーザー情報
- 名前: 文字列
- メールアドレス: 文字列（ユニーク、必須）
- パスワード: 文字列（ハッシュ化して保存）
- 役割（ロール）: 列挙型（'USER', 'ADMIN'）
- サブID（sub）: 文字列（認証用ユニークID）
- 作成日時: 日付（自動設定）
- 更新日時: 日付（自動更新）

### セッション/JWT情報
- トークン（JWT）
  - サブID（sub）: ユーザー識別子
  - 名前（name）: ユーザー名
  - メールアドレス（email）: ユーザーのメールアドレス
  - 役割（role）: ユーザーの権限レベル
  - 発行日時（iat）: トークン発行日時
  - 有効期限（exp）: トークン有効期限
  - トークンID（jti）: 一意のトークン識別子

## 画面説明

### ログイン画面
- メールアドレス入力フィールド
- パスワード入力フィールド（マスク表示）
- ログインボタン
- エラーメッセージ表示領域
- 「パスワードを忘れた場合」へのリンク（将来実装予定）

## 操作方法

### ログイン方法
1. ログイン画面にアクセス（http://localhost:3000/login）
2. メールアドレスとパスワードを入力
3. ログインボタンをクリック
4. 認証成功時はダッシュボードなどのメイン画面にリダイレクト
5. 失敗時はエラーメッセージを表示

### ログアウト方法
1. 画面右上のユーザーメニューをクリック
2. ドロップダウンメニューから「ログアウト」を選択
3. セッションが終了し、ログイン画面にリダイレクト

## テストアカウント

### 一般ユーザー
- メールアドレス: test@example.com
- パスワード: password123
- 権限: USER

### 管理者ユーザー
- メールアドレス: admin@example.com
- パスワード: admin123
- 権限: ADMIN

## 技術仕様

- NextAuth.js による認証システム実装
- JWT（JSON Web Token）によるステートレス認証
- MongoDB でのユーザー情報保存
- bcrypt によるパスワードハッシュ化
- ミドルウェアによるルートごとの認証チェック

## セキュリティ注意事項

- 本番環境ではHTTPS通信を使用すること
- JWT Secret は環境変数で管理し、ソースコード内に記載しないこと
- パスワードリセット機能を実装する際は、メール認証等の二次認証を設けること
- セッションタイムアウトは適切な時間（例：8時間）に設定すること 