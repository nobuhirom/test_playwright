# 顧客管理システム（CRM）要件定義

## 機能要件

### ユーザー認証機能
- メールアドレスとパスワードによる認証
- ユーザー登録機能
- パスワードリセット機能（メール送信）

### ユーザー権限管理
- 管理者：全機能の利用・閲覧が可能
- 一般ユーザー：担当顧客・案件のみ閲覧・編集可能

### 顧客情報管理 ✅
- 顧客情報の登録・閲覧・編集・削除
  - 基本情報：会社名、担当者名、電話番号、メールアドレス、住所、業種など
  - 対応履歴の記録と表示
  - 関連案件一覧の表示
- 検索・フィルタリング機能
  - 会社名、担当者名による検索
  - 業種によるフィルタリング
  - ステータスによるフィルタリング

### 商談/案件管理 ✅
- 新規案件の作成
- 案件情報：タイトル、金額、確度、ステータス、期限、担当者
- ステータス更新（提案中/交渉中/成約/失注）
- 履歴管理

### タスク管理 ✅
- タスクの作成
- タスク詳細：タイトル、説明、期限、ステータス
- 担当者の割り当て
- ステータス更新（未着手/進行中/完了）
- 期限設定と期限通知

### ダッシュボード表示 ✅
- 月次売上予測グラフ
- 商談進捗状況の円グラフ
- 期限間近のタスク一覧
- 進行中の案件一覧

### 検索・フィルタリング機能 ✅
- 顧客名、案件名による検索
- 金額範囲によるフィルタリング
- ステータスによるフィルタリング
- 担当者によるフィルタリング

### レポート生成・エクスポート機能
- CSV形式でのデータエクスポート
- 顧客リスト出力
- 案件リスト出力
- 期間指定での売上レポート

## データモデル（MongoDB Schema）

### ユーザー (users) ✅
```typescript
{
  _id: ObjectId,
  name: String,
  email: String,          // unique: true
  password: String,       // ハッシュ化
  role: String,          // enum: ['ADMIN', 'USER']
  createdAt: Date,
  updatedAt: Date
}
```

### 顧客 (customers) ✅
```typescript
{
  _id: ObjectId,
  companyName: String,
  contactName: String,
  phone: String,
  email: String,
  address: String,
  industry: String,
  status: String,        // enum: ['ACTIVE', 'INACTIVE']
  assignedTo: ObjectId,  // ref: 'users'
  createdAt: Date,
  updatedAt: Date
}
```

### 商談/案件 (projects) ✅
```typescript
{
  _id: ObjectId,
  title: String,
  customerId: ObjectId,  // ref: 'customers'
  amount: Number,
  probability: Number,   // 0-100
  status: String,       // enum: ['PROPOSAL', 'NEGOTIATION', 'WON', 'LOST']
  dueDate: Date,
  assignedTo: ObjectId, // ref: 'users'
  createdAt: Date,
  updatedAt: Date
}
```

### タスク (tasks) ✅
```typescript
{
  _id: ObjectId,
  title: String,
  description: String,
  projectId: ObjectId,   // ref: 'projects', optional
  dueDate: Date,
  status: String,       // enum: ['TODO', 'IN_PROGRESS', 'DONE']
  assignedTo: ObjectId, // ref: 'users'
  createdAt: Date,
  updatedAt: Date
}
```

### 対応履歴 (activities)
```typescript
{
  _id: ObjectId,
  customerId: ObjectId,  // ref: 'customers'
  content: String,
  activityDate: Date,
  userId: ObjectId,      // ref: 'users'
  createdAt: Date
}
```

### インデックス設定 ✅
- users: email (unique)
- customers: companyName, assignedTo
- projects: customerId, assignedTo, status
- tasks: projectId, assignedTo, status, dueDate
- activities: customerId, userId, activityDate

## 開発環境・ツール

### 使用する言語・フレームワーク

#### フロントエンド ✅
- React + TypeScript
  - Next.js（SSR、ルーティング）
  - TailwindCSS（スタイリング）

#### バックエンド ✅
- Node.js + Express
  - TypeScript

#### データベース ✅
- MongoDB
  - Mongoose ODM（スキーマ定義、バリデーション）
  - MongoDB Atlas（本番環境）

#### 認証
- NextAuth.js
  - JWT認証
  - MongoDB セッションストア

#### テスト環境
- Playwright（E2Eテスト）
- Jest（ユニットテスト）
- React Testing Library（コンポーネントテスト）

#### 開発ツール
- Docker（開発環境の統一）
- Git（バージョン管理）
- ESLint + Prettier（コード品質管理）

### 開発環境の特徴
1. JavaScript/TypeScriptベースで統一された開発環境
2. モダンな技術スタックによる保守性の向上
3. テスト駆動開発（TDD）に適した環境
4. スケーラブルな構成
