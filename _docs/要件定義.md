# CRMシステム要件定義

## 1. システム概要

### 1.1 目的
- 顧客情報の一元管理
- 商談進捗の可視化
- タスク管理の効率化
- 売上予測の精度向上

### 1.2 対象ユーザー
- 営業担当者
- 管理者
- システム管理者

### 1.3 主要機能
- ✅ ユーザー認証
  - ✅ ログイン/ログアウト
  - ✅ パスワードリセット
  - ✅ ユーザーロール管理
  - [ ] メール認証
- ✅ 顧客情報管理
  - ✅ 顧客基本情報の登録・編集
  - ✅ 顧客一覧表示
  - ✅ 顧客詳細表示
- ✅ プロジェクト管理
  - ✅ プロジェクトの作成・編集
  - ✅ プロジェクト一覧表示
  - ✅ プロジェクト詳細表示
- ✅ タスク管理
  - ✅ タスクの作成・編集
  - ✅ タスク一覧表示
  - ✅ タスク詳細表示
- [ ] ダッシュボード
  - [ ] 売上予測グラフ
  - [ ] 商談進捗状況
  - [ ] 期限間近タスク
  - [ ] 進行中案件
- ✅ 検索・フィルタリング
  - ✅ 顧客検索
  - ✅ プロジェクト検索
  - ✅ タスク検索

### 1.4 技術スタック
- フロントエンド
  - ✅ React
  - ✅ TypeScript
  - ✅ Next.js
  - ✅ Tailwind CSS
- バックエンド
  - ✅ Node.js
  - ✅ Next.js API Routes
  - ✅ MongoDB
  - ✅ Mongoose
- 認証
  - ✅ NextAuth.js
  - ✅ bcryptjs
- テスト
  - [ ] Jest
  - [ ] React Testing Library
  - [ ] Playwright
- デプロイ
  - [ ] Docker
  - [ ] GitHub Actions
  - [ ] Vercel

## 2. データモデル

### 2.1 ユーザー（User）
```typescript
{
  id: string;
  name: string;
  email: string;
  password: string; // ハッシュ化
  role: 'ADMIN' | 'USER';
  resetToken?: string;
  resetTokenExpiry?: Date;
  // emailVerified?: Date; // メール認証実装時に追加予定
  createdAt: Date;
  updatedAt: Date;
}
```

### 2.2 顧客（Customer）
```typescript
{
  id: string;
  companyName: string;
  contactName?: string;
  email?: string;
  phone?: string;
  address?: string;
  industry?: string;
  status: 'リード' | '商談中' | '成約' | '失注';
  notes?: string;
  assignedTo?: string; // 担当者ID（Userモデルへの参照）
  createdAt: Date;
  updatedAt: Date;
}
```

### 2.3 プロジェクト（Project）
```typescript
{
  id: string;
  title: string;
  customerId: string; // 顧客ID（Customerモデルへの参照）
  amount?: number; // 金額
  probability?: number; // 確度（0〜100%）
  description?: string;
  status: 'PROPOSAL' | 'NEGOTIATION' | 'WON' | 'LOST';
  dueDate?: Date; // 期日
  assignedTo?: string; // 担当者ID（Userモデルへの参照）
  createdBy: string; // 作成者ID（Userモデルへの参照）
  createdAt: Date;
  updatedAt: Date;
}
```

### 2.4 タスク（Task）
```typescript
{
  id: string;
  title: string;
  description: string;
  projectId?: string; // プロジェクトID（Projectモデルへの参照）
  assignedTo: string; // 担当者ID（Userモデルへの参照）
  status: 'TODO' | 'IN_PROGRESS' | 'DONE';
  // priority: 'LOW' | 'MEDIUM' | 'HIGH'; // 未実装
  dueDate: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

### 2.5 活動履歴（Activity）
```typescript
{
  id: string;
  customerId: string; // 顧客ID（Customerモデルへの参照）
  content: string; // 活動内容
  activityDate: Date; // 活動日時
  userId: string; // ユーザーID（Userモデルへの参照）
  createdAt: Date;
  updatedAt: Date;
}
```

## 3. 画面設計

### 3.1 共通レイアウト
- ✅ ヘッダー
  - ✅ ロゴ
  - ✅ ナビゲーションメニュー
  - ✅ ユーザーメニュー
- ✅ サイドバー
  - ✅ メニュー項目
  - ✅ 折りたたみ機能

### 3.2 認証画面
- ✅ ログイン画面
- ✅ パスワードリセット画面
  - ✅ リセットリンク要求
  - ✅ パスワード更新
- [ ] メール認証画面
  - [ ] メール確認画面
  - [ ] メール再送信機能

### 3.3 ダッシュボード
- ✅ 売上予測グラフ
- ✅ 商談進捗状況
- ✅ 期限間近タスク
- ✅ 進行中案件

### 3.4 顧客管理
- ✅ 顧客一覧
- ✅ 顧客詳細
- ✅ 顧客編集

### 3.5 プロジェクト管理
- ✅ プロジェクト一覧
- ✅ プロジェクト詳細
- ✅ プロジェクト編集

### 3.6 タスク管理
- ✅ タスク一覧
- ✅ タスク詳細
- ✅ タスク編集

## 4. セキュリティ要件

### 4.1 認証・認可
- ✅ ユーザー認証
- ✅ パスワードハッシュ化
- ✅ パスワードリセット機能
- ✅ ロールベースアクセス制御
- [ ] メール認証
- [ ] 2要素認証

### 4.2 データ保護
- ✅ 入力値のバリデーション
- ✅ XSS対策
- ✅ CSRF対策
- [ ] レート制限
- [ ] IP制限

## 5. 非機能要件

### 5.1 パフォーマンス
- ✅ ページロード時間の最適化
- ✅ データベースクエリの最適化
- [ ] キャッシュ戦略
- [ ] CDNの活用

### 5.2 可用性
- ✅ エラーハンドリング
- ✅ ユーザーフィードバック
- [ ] バックアップ戦略
- [ ] 障害復旧手順

### 5.3 保守性
- ✅ コードの整理
- ✅ ドキュメント整備
  - ✅ 機能仕様書
    - ✅ 認証機能
    - ✅ ダッシュボード機能
    - ✅ プロジェクト管理機能
    - ✅ タスク管理機能
    - ✅ 顧客管理機能
    - ✅ ユーザー管理機能
    - ✅ レポート・分析機能
    - ✅ システム設定
  - [ ] API仕様書
  - [ ] デプロイ手順書
  - [ ] 運用マニュアル
- [ ] テストカバレッジ
- [ ] CI/CDパイプライン

### 5.4 監視・運用
- [ ] ログ収集
- [ ] メトリクス収集
- [ ] アラート設定
- [ ] パフォーマンスモニタリング
